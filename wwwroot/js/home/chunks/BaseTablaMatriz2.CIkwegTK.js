import{r as s,j as n}from"../index.DKk2s01l.js";import{L as ee,S as te,P as ne}from"./Stack.eFpAXuqd.js";import{a as se}from"./useTablaVirtualizadaCustom.YaVcVRmy.js";const re=s.memo(({virtualRow:l,filaFiltrada:x,isEven:k,isSelected:w,effectiveWidth:f,cabeceraFiltrada:$,onClick:i,onDoubleClick:a,selectedRadio:j,handleRadioClick:M,selectedChecked:S,handleCheckDelete:C,listaLength:D,isEditing:m})=>n.jsxs("div",{"data-row-index":l.index,onClick:i,onDoubleClick:a,className:`absolute left-0 flex border-b border-gray-200 cursor-pointer transition-colors duration-150 ${w?"bg-indigo-200":k?"bg-white":"bg-gray-50"} hover:bg-indigo-100 active:bg-indigo-300`,style:{transform:`translateY(${l.start}px)`,width:`${f}px`},children:[x.map((h,g)=>n.jsx("div",{className:"px-2 py-2 text-left",style:{minWidth:`${$[g][1]}px`,flexShrink:0},children:h},g)),m&&n.jsx("div",{className:"px-2 py-2 text-center",style:{minWidth:"80px"},children:n.jsx("input",{type:"radio",name:"editarFila",value:l.index,checked:j===l.index,onChange:()=>{},onClick:()=>M(l.index),className:"h-4 w-4 appearance-none border border-gray-300 rounded-sm checked:bg-blue-600 checked:border-blue-600 focus:ring-2 focus:ring-blue-500"})}),m&&n.jsx("div",{className:"px-2 py-2 text-center",style:{minWidth:"80px"},children:n.jsx("input",{type:"checkbox",name:`eliminarFila-${l.index}`,value:l.index,checked:S.includes(l.index)&&l.index<D,onChange:()=>{},onClick:()=>C(l.index),className:"h-4 w-4 appearance-none border border-gray-300 rounded-sm checked:bg-blue-600 checked:border-blue-600 focus:ring-2 focus:ring-blue-500"})})]})),ie=({configTable:l,handleRadioClick:x,handleCheckDelete:k,isEditing:w,onSelect:f})=>{const{title:$,isPaginar:i,listaDatos:a,offsetColumnas:j}=l,M=a,[S,C]=s.useState(null),[D,m]=s.useState([]),h=s.useMemo(()=>a&&a.length>2?a.slice(2):[],[a]),[g,W]=s.useState(1),z=20,[P,q]=s.useState(null),[F,ae]=s.useState(""),A=s.useRef(null);s.useEffect(()=>{A.current?.focus()},[]);const y=s.useMemo(()=>{if(!F.trim())return h;const e=F.toLowerCase();return h.filter(t=>t.toLowerCase().includes(e))},[h,F]),G=s.useMemo(()=>y.length,[y]);s.useEffect(()=>{W(1)},[]);const v=Math.max(1,Math.ceil(y.length/z));s.useEffect(()=>{i&&g>v&&W(v)},[i,g,v]);const N=(g-1)*z,H=N+z,V=y.slice(N,H),J=(e,t)=>{t>=1&&t<=v&&W(t)},o=s.useMemo(()=>(i?V:y).map(t=>{const r=t.split("|");return{completa:r,visible:r.slice(j)}}),[i,V,y,j]);s.useEffect(()=>{if(!a||a.length===0){m([]);return}const e=o.reduce((t,r,d)=>{const u=r?.completa;return u&&u[7]==="0"&&t.push(d),t},[]);m(t=>{const r=(t||[]).filter(b=>b>=0&&b<o.length),d=Array.from(new Set([...r,...e]));return r.length===d.length&&r.every((b,U)=>b===d[U])?t:d})},[a,o]);const Q=s.useCallback(e=>{C(t=>{const r=t===e?null:e;m(u=>u.filter(b=>b!==e));const d=o[e];if(d&&r!==null){const u=[...d.completa,e];x?.(u)}else x?.(null);return r})},[o,x]),X=s.useCallback(e=>{m(t=>{const r=t.includes(e),d=r?t.filter(R=>R!==e):[...t,e],u=r?0:1;!r&&S===e&&(C(null),x?.(null));const _=(a&&h?a.length-h.length:2)+(i?N:0)+e,Y=o[e];return k?.(Y?{fila:Y.completa,index:_,checked:u}:null),d})},[o,h,a,N,i,k,S,x]),{cabeceraFiltrada:O,totalWidth:B,rowVirtualizer:c,scrollBarRef:Z,tableContainerRef:I,syncScroll:K}=se(o,M,j);s.useEffect(()=>{if(!I.current)return;const e=new ResizeObserver(([t])=>{q(t.contentRect.width)});return e.observe(I.current),()=>e.disconnect()},[I]);const[p,E]=s.useState(null),L=s.useCallback(e=>{if(e.key==="Enter"&&document.activeElement===A.current){e.stopPropagation(),e.preventDefault();return}if(c.getTotalSize()!==0){if(e.key==="ArrowDown")E(t=>{const r=t===null?0:Math.min(t+1,c.getTotalSize()-1);return c.scrollToIndex(r,{align:"center",behavior:"smooth"}),r}),e.preventDefault();else if(e.key==="ArrowUp")E(t=>{const r=t===null?0:Math.max(t-1,0);return c.scrollToIndex(r,{align:"center",behavior:"smooth"}),r}),e.preventDefault();else if(e.key==="Enter"&&p!=null){const t=o[p];t&&f&&f(t.completa),e.preventDefault()}}},[c,p,o,f]);if(s.useEffect(()=>(window.addEventListener("keydown",L),()=>{window.removeEventListener("keydown",L)}),[L]),s.useEffect(()=>{p!=null&&c.scrollToIndex(p,{align:"center",behavior:"smooth"})},[p,c]),!a||a.length<=1)return n.jsx(ee,{});const T=P!=null?Math.max(P-32,B):B;return n.jsxs(n.Fragment,{children:[n.jsxs("div",{ref:I,className:"relative overflow-y-auto  min-h-0 bg-white shadow-lg rounded-lg border border-gray-200 outline-none",onScroll:()=>K("table"),tabIndex:0,children:[n.jsx("div",{className:"sticky top-0 left-0 z-30 bg-white shadow-md",children:n.jsxs("h2",{className:"text-left text-xl text-green-700 font-bold py-2 px-4",children:[$," ",n.jsx("span",{className:"ml-2 text-sm font-medium text-gray-500",children:`(${G} Reg.)`})]})}),n.jsxs("div",{className:"sticky top-10 z-20 flex border-b border-gray-300 bg-gray-100",style:{width:`${T}px`},children:[O.map((e,t)=>n.jsx("div",{className:"px-2 py-2 font-semibold text-left",style:{minWidth:`${e[1]}px`,flexShrink:0},children:e[0]},t)),w&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"px-2 py-2 font-semibold text-center text-blue-600",style:{minWidth:"80px"},children:"EDITAR"}),n.jsx("div",{className:"px-2 py-2 font-semibold text-center text-blue-600",style:{minWidth:"80px"},children:"ELIMINAR"})]})]}),n.jsx("div",{className:"relative",style:{height:i?`${c.getVirtualItems().length*35}px`:`${c.getTotalSize()}px`,width:`${T}px`},children:c.getVirtualItems().map(e=>{const t=o[e.index];return t?n.jsx(re,{virtualRow:e,filaFiltrada:t.visible,isEven:e.index%2===0,isSelected:e.index===p,effectiveWidth:T,cabeceraFiltrada:O,selectedRadio:S,handleRadioClick:Q,selectedChecked:D,handleCheckDelete:X,onClick:()=>{E(e.index),c.scrollToIndex(e.index,{align:"center",behavior:"smooth"})},onDoubleClick:()=>{E(e.index),t&&f&&f(t.completa)},listaLength:a.length,isEditing:w},e.index):null})})]}),n.jsx("div",{ref:Z,className:"fixed bottom-0 left-0 w-full h-5 overflow-x-auto bg-gray-100",onScroll:()=>K("bar"),children:n.jsx("div",{className:"h-1",style:{width:`${T}px`}})}),i&&n.jsx(te,{spacing:2,className:"mt-4 flex justify-center",children:n.jsx(ne,{count:v,page:g,onChange:J,shape:"rounded",color:"primary"})})]})};export{ie as B};
