import{r as n,j as f,u as ae,e as se}from"../index.BrPz-MZr.js";import{u as oe}from"./useFetch.ClVmkW40.js";import{u as Bt}from"./useTablaVirtualizadaCustom.y-cIBxX4.js";import{u as k,C as xt,a as ne}from"./CustomElement.C6AuAZ9V.js";import{B as Vt}from"./BaseTablaMatriz2.CFIIuuYC.js";import{C as ie}from"./ConfirmDialog.YkHAmLtH.js";import"./Stack.DPLBjCES.js";const re=n.forwardRef(({onClose:q,etiqueta:Q,ancho:bt,listaDatos:st,onChange:jt,parentRef:$,offsetColumnas:Tt,progRuta:z,metaDataKeys:Et,usuario:ct},It)=>{const I=n.useRef([]),[Dt]=n.useState({}),[wt,ot]=n.useState(!1),[St,Pt]=n.useState(null),[Y,Z]=n.useState([]),[U,G]=n.useState({}),[B,J]=n.useState([]),[K,dt]=n.useState({}),[Ot,W]=n.useState({}),[C,w]=n.useState(!1),[P,ut]=n.useState([]),[H,X]=n.useState(""),[Ft,tt]=n.useState("success"),[Gt,nt]=n.useState(!1),{runFetch:it}=Bt(),mt=l=>{let c=0;for(let p=0;p<l.length;p++)c=(c<<5)-c+l.charCodeAt(p),c|=0;return c.toString()},S=k(l=>l.setSelectedItems);n.useEffect(()=>{const{selectedItems:l}=k.getState();l||S([])},[]),n.useEffect(()=>{Pt(z)},[z]),n.useEffect(()=>{Z(Et)},[Et]);const ft=st?.[0],rt=[],Ct=(typeof ft=="string"?ft.split("|"):[]).map((l,c)=>({data:rt[c]??"",metadata:(l??"").split("*")})),pt=(st??[]).slice(1);n.useEffect(()=>{if(Y.length===0)return;const l=Y.slice(1,3),c=Y.slice(3);for(const p of c){const a=p.split("|");Number(a[2])===Number(St)&&l.push(a.join("|"))}J(l)},[Y,St]),n.useEffect(()=>{G(l=>{const c=B||[],p=l?.hash||[],a=c.map((d,x)=>{const g=p[x];if(typeof g<"u")return g;const v=d.split("|");return!v[1]||v[1].trim()===""?"":mt(d)});return{...l,title:"PROGRAMACION DE GRIFOS:",isPaginar:!1,listaDatos:c,offsetColumnas:11,hash:a}})},[B]);const yt={default:[]};n.useImperativeHandle(It,()=>({updateSelected(l,c){try{$&&$.current&&($.current.dataset.value=l,$.current.dataset.label=c,$.current.value=l)}catch(p){console.warn("Error al propagar al padre:",p)}}})),n.useEffect(()=>{B&&B.length>2?ot(!0):ot(!1)},[B]);const ht=()=>{const c=I.current.filter(Boolean).find(a=>a?.dataset?.item==="701"),p=[{item:"702",index:8},{item:"703",index:9},{item:"704",index:10},{item:"705",index:5},{item:"706",index:4}];w(!1),c&&c.tagName==="SELECT"&&(setTimeout(()=>{c.dataset.value=""},1e3),dt(a=>({...a,701:{value:"",label:""}})),W(a=>({...a,701:0}))),p.forEach(({item:a})=>{I.current.forEach(d=>{d?.dataset?.item===a&&(d.dataset.value="",d.value="")})})},At=l=>{const p=I.current.filter(Boolean).find(d=>d?.dataset?.item==="701"),a=[{item:"702",index:8},{item:"703",index:9},{item:"704",index:10},{item:"705",index:5},{item:"706",index:4}];l?(w(!0),ut(l),a.forEach(({item:d,index:x})=>{I.current.forEach(g=>{if(g?.dataset?.item===d){let v=l[x];g.type==="date"&&v&&(v=v.split("T")[0]),g.dataset.value=v,g.value=v}})}),p&&p.tagName==="SELECT"&&(p.dataset.value=l[3],dt(d=>({...d,701:{value:l[3],label:l[7]}})),W(d=>({...d,701:1})))):(w(!1),ht(),ut([]))},Nt=l=>{if(!l)return;const c=l.index;l.fila[1]===""?(G(p=>({...p,listaDatos:(p.listaDatos||[]).filter((a,d)=>d!==c)})),J(p=>p.filter((a,d)=>d!==c))):G(p=>{const a=[...p.listaDatos||[]];if(c>-1&&c<a.length){const d=a[c].split("|");d[6]=l.checked===1?"0":"1",a[c]=d.join("|")}return{...p,listaDatos:a}})},et=()=>{const l=I.current.filter(Boolean).find(a=>a.dataset.item==="701"&&a.dataset.value!==""),c=I.current.filter(Boolean).find(a=>a.dataset.item==="705"&&a.dataset.value!=="");if(!(!!l&&!!c)){alert("Existen valores requeridos...");return}if(C){const a=I.current.filter(Boolean).find(A=>A.dataset.item==="705"),d=I.current.filter(Boolean).find(A=>A.dataset.item==="706"),x=a.value,g=d.value;let v=[];const{selectedItems:N}=k.getState();N&&N.length>0&&(v=N[0],P[3]=v[0],P[7]=v[2],P[8]=v[4],P[9]=v[5],P[10]=v[6],P[11]=v[7]),k.setState({selectedItems:[]}),P[4]=g,P[5]=x,P[12]=x;const O=Number(P.slice(-1)[0])+2;if(!isNaN(O)){const A=P.slice(0,-1).join("|"),j=mt(A),kt=U?.hash[O];if(j!==kt){const V=[...U.listaDatos||[]];V[O]=A,G(gt=>({...gt,listaDatos:V})),J(V),ht()}}}else{const a=I.current.filter(Boolean).find(N=>N.dataset.item==="706"),{selectedItems:d}=k.getState();if(!d||d.length===0)return;const x=d[0],g=[];g.push(Y[0]),g.push(""),g.push(St),g.push(x[0]),g.push(a.value),g.push(c.value),g.push("1"),g.push(x[2]),g.push(x[4]),g.push(x[5]),g.push(x[6]),g.push(x[2]),g.push(c.value);const v=g.join("|");J(N=>{const O=Array.isArray(N)?[...N,v]:[v];return G(A=>({...A,listaDatos:[...A.listaDatos||[],v],hash:[...A.hash,""]})),O}),k.setState({selectedItems:[]}),ht()}},Rt=()=>{const{selectedItems:l}=k.getState();if(!l||l.length===0)return;const c=l[0];[{item:"702",index:4},{item:"703",index:5},{item:"704",index:6}].forEach(({item:x,index:g})=>{I.current.forEach(v=>{v.dataset.item===x&&(v.dataset.value=c[g],v.value=c[g])})});const a="701",d=I.current.filter(Boolean).find(x=>x?.dataset?.item===a);d&&d.tagName==="SELECT"&&(d.dataset.value=c[0],dt(x=>({...x,[a]:{value:c[0],label:c[2]}})),W(x=>({...x,[a]:1})))},Lt=async()=>{const l=[],c=[];let p="",a="";if(U&&Array.isArray(U.listaDatos)&&U?.listaDatos.length>0&&U.listaDatos.forEach((N,O)=>{if(O>1){const A=U?.hash[O],j=mt(N);if(A!==j){const V=N.split("|").slice(0,7),[gt,...Mt]=V,Ut=Mt.join("|");l.push(gt.replaceAll("+","|")),c.push(Ut)}}}),c.length>0&&l.length>0)p=ct.trim()+"~"+c.join("|")+"|"+l.join("|");else{X("NO existen datos que enviar"),tt("error"),setTimeout(()=>X(""),2e3);return}const d=a+"^"+p;if(a.trim()===""&&p.trim()==="")return;const x=new FormData;x.append("data",d),nt(!0);let g=!1,v="";try{const N=await it("/Home/TraerDatosProg_eo_grifo",{method:"POST",body:x});N&&(g=!0,v=N,X("Datos Guardados Correctamente ..."),tt("success"),w(!0))}catch(N){console.error(N),X("Error al guardar la informacion ..."),tt("error")}finally{nt(!1),setTimeout(()=>{X(""),g&&typeof q=="function"&&typeof v=="string"&&q(v)},1e3)}},lt=()=>{};return f.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:f.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg",style:{width:bt?`${bt}px`:"80vw"},children:[f.jsxs("h2",{className:"text-lg font-bold mb-4 flex items-center justify-start gap-5",children:["UNIDAD:","  "," ",Q]}),f.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:Ct.map((l,c)=>{const{data:p,metadata:a}=l,d=Number(a?.[5]??0);let x=a?.[3]?Number(a[3]):0;const g=a?.[1]==="0",v=a?.[8]==="1",N=a?.[14]==="1";x=a?.[4]===""?x:Number(a[4]);const O={1:"col-span-1",2:"col-span-2",3:"col-span-3",4:"col-span-4"};return f.jsx("div",{className:`${O[a?.[10]]??"col-span-1"} min-w-0`,children:f.jsx(xt,{ref:A=>{A&&(I.current[a[6]]=A)},typeCode:d,etiqueta:a[7]??"",placeholder:a[7]??"",popupTipo:a[6]??"",style:N?{visibility:"hidden",position:"absolute",width:0,height:0,overflow:"hidden"}:{},...x>0?{maxLength:x}:{},...v?{disabled:!0}:{},...g?{required:!0}:{},...d===103?{checked:(Dt[a[0]]?.value??p)==="1"}:{},...a?.[2]==="1"&&d===101?{tipoDato:"entero"}:{},...a?.[2]==="2"&&d===101?{tipoDato:"decimal"}:{},...d===111?{defaultValue:yt[a[6]]?.length>0?l.metadata[0]:"",...a?.[11]==="1"?{isDefault:1}:{},options:yt.default}:d===151?{options:pt,unaLinea:a?.[11],offsetColumnas:a?.[12],ancho:a?.[13],forcedOption:K?.[a[6]]??null,optionFlag:Ot?.[a[6]]??null,setOptionFlag:A=>{W(j=>({...j,[a[6]]:A}))},onPopupClose:()=>Rt()}:{defaultValue:l.data},dataAttrs:{value:Dt[a[0]]?.value??p,valor:p,campo:a[0],item:a[6]}},c)},c)})}),f.jsxs("div",{className:"mt-8 mb-2",children:[f.jsx(xt,{typeCode:120,onClick:()=>et(),style:{width:"50%"},className:"font-bold text-white text-lg border border-gray-300 rounded shadow-md px-3 py-1",children:C?"EDITAR RUTA GRIFO":"AGREGAR NUEVA RUTA GRIFO"}),!wt&&f.jsx("h2",{className:"mt-4 text-lg font-semibold text-green-700 mb-4 border-b border-green-300 pb-1",children:"PROGRAMACION DE GRIFOS:"})]}),f.jsx("div",{className:"mb-4 flex-1 min-h-0 overflow-y-auto pr-2",children:wt&&f.jsx("div",{style:{maxHeight:"50vh",overflowY:"auto",border:"1px solid #e5e7eb",borderRadius:"0.5rem"},children:f.jsx(Vt,{configTable:U,handleRadioClick:At,handleCheckDelete:Nt,isEditing:!0,onSelect:lt})})}),H&&f.jsx("div",{className:`mt-3 p-3 text-sm rounded-md shadow-md ${Ft==="success"?"bg-green-700 text-white animate-bounce":"bg-red-400 text-white animate-bounce"}`,children:H}),f.jsxs("div",{className:"flex justify-between mt-4",children:[f.jsx("button",{onClick:Lt,...Gt?{disabled:!0}:{},className:"bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-2 rounded-md",children:"GRABAR PROGRAMACION DE GRIFO"}),f.jsx("button",{onClick:()=>{typeof q=="function"&&q(null)},className:"bg-gray-300 hover:bg-gray-400 text-gray-800 px-4 py-2 rounded-md",children:"Cerrar"})]})]})})}),he=()=>{ae();const[q,Q]=n.useState({});n.useRef(null);const[bt,st]=n.useState(!1),[jt,$]=n.useState(!1),[Tt,z]=n.useState(""),[Et,ct]=n.useState("success"),[It,I]=n.useState(0),[Dt,wt]=n.useState(""),[ot,St]=n.useState(!1),Pt=n.useRef(ot),[Y,Z]=n.useState({}),[U,G]=n.useState({}),[B,J]=n.useState({}),[K,dt]=n.useState([]),[Ot,W]=n.useState(""),[C,w]=n.useState({}),[P,ut]=n.useState(!1),[H,X]=n.useState({}),[Ft,tt]=n.useState([]),[Gt,nt]=n.useState(!1),[it,mt]=n.useState(""),S=n.useRef([]),ft="/Home/TraerListaProgExtraOrd",{data:rt,loading:Ht,error:Ct}=oe(ft),{runFetch:pt}=Bt(),yt=ne(S),{handleClick:ht,mensajeError:At,esValido:Nt,valoresCambiados:et}=yt,Rt=n.useRef(null),Lt=se();n.useEffect(()=>{Pt.current=ot},[ot]),n.useEffect(()=>{let t=!1;S.current.forEach(s=>{s?.type==="hidden"&&s.dataset.value?.trim()!==""&&(t=!0)}),t&&st(!0)},[]);const lt=t=>{let s=0;for(let i=0;i<t.length;i++)s=(s<<5)-s+t.charCodeAt(i),s|=0;return s.toString()},l=k(t=>t.selectedItems),c=n.useRef(!1);n.useEffect(()=>{if(c.current||l.length===0)return;const t=l[0]?.[0],s=l[0]?.slice(-1)[0];mt(s),t&&(c.current=!0,p(t),k.setState({selectedItems:[]}))},[l]);const p=async t=>{Z({}),G({}),Q({}),w({});const s=`zz|${t}`,i=await pt(`${ft}Param?dato=${encodeURIComponent(s)}`,{method:"GET",headers:{Accept:"text/plain","Content-Type":"text/plain"}}),u=typeof i=="string"?i.split("~"):[],e=u?.[0]?.split("|")??[],r=u?.[1]?.split("|")??[],h=u?.slice(3)?.join("~"),b=r.map((m,R)=>({data:e[R]??"",metadata:(m??"").split("*")}));if(b.filter(m=>m.metadata?.[5]==="100").forEach(m=>{const R=m.metadata[0],E=m.data;E&&E.trim()!==""&&(S.current.forEach(o=>{o?.type==="hidden"&&o.dataset.campo===R&&(o.value=E,o.dataset.value=E)}),st(!0))}),b.filter(m=>m.metadata?.[5]!=="100").forEach(m=>{const R=m.metadata[0],E=m.data,o=S.current.find(D=>D?.dataset?.campo===R);if(o)if(o.tagName==="SELECT"){const D=String(E).trim(),F=()=>{const y=L=>String(L??"").trim().toUpperCase(),M=Array.from(o.options||[]),T=M.find(L=>y(L.value)===y(E));if(T){const L=M.indexOf(T);return M.forEach(at=>at.selected=!1),T.selected=!0,o.selectedIndex=L,o.value=T.value,o.dataset.value=T.value,o.dataset.valor=T.value,(!o.dataset.valor||o.dataset.valor==="")&&(o.dataset.valor=o.dataset.value),!0}return!1};o.disabled&&(o.disabled=!1),F(),Q(y=>({...y,[m.metadata[6]]:{value:D,valor:D,item:m}}))}else["INPUT","TEXTAREA"].includes(o.tagName)&&(o.value=E,o.dataset.value=E,o.dataset.valor=E,o.dispatchEvent(new Event("input",{bubbles:!0})),Q(D=>({...D,[m.metadata[6]]:{value:E,valor:E,item:m}})))}),h){const m=h.split("^"),R=m.filter(y=>y.split("~")[0]==="741").flatMap(y=>y.split("~").slice(1));W(R[0]);const E=R.slice(1),o=E.map(lt);w({title:"PROGRAMACION DE RUTAS:",isPaginar:!1,listaDatos:E,offsetColumnas:11,hash:o});const D=m.filter(y=>y.split("~")[0]==="743").flatMap(y=>y.split("~").slice(1));tt(D);const F=m.filter(y=>y.split("~")[0]!=="741"),_=F.length;for(let y=0;y<_;y++){const M=F[y].split("~"),T=M.length-1,L=M[0],at=M[T]?.split("|")??[],qt=S.current.find(vt=>vt?.dataset?.item===L);qt&&qt.tagName==="SELECT"&&(Z(vt=>({...vt,[L]:{value:at[0],label:at[1]}})),G(vt=>({...vt,[L]:1})));const{setSelectedItems:ee}=k.getState();ee([at]),_t(L)}}setTimeout(()=>{S.current.forEach(m=>{m&&m.dataset&&(m.dataset.valor=m.dataset.value)})},100)},a=n.useCallback(async()=>{const t=[],s=[];let i="",u="";if(C&&Array.isArray(C.listaDatos)&&C?.listaDatos.length>0&&C.listaDatos.forEach((o,D)=>{if(D>1){const F=C?.hash[D],_=lt(o);if(F!==_){const M=o.split("|").slice(0,8),[T,...L]=M,at=L.join("|");t.push(T.replaceAll("+","|")),s.push(at)}}}),!et.data.length&&!et.campos.length&&!(s.length>0&&t.length>0)){z("NO existen datos que enviar"),ct("error"),setTimeout(()=>z(""),2e3);return}s.length>0&&t.length>0&&(i=it.trim()+"~"+s.join("|")+"|"+t.join("|"));const e=[...et.data],r=[...et.campos],h=new Set;!r.map(o=>!!S.current.find(F=>F?.dataset?.campo===o&&F?.type==="hidden")).includes(!1)||(Object.values(S.current).forEach(o=>{if(o?.type==="hidden"&&o.dataset.campo){const D=`${o.dataset.campo}-${o.dataset.value}`;h.has(D)||(h.add(D),r.unshift(o.dataset.campo),e.unshift(o.dataset.value))}}),u=it.trim()+"~"+e.join("|")+"|"+r.join("|"));const R=u+"^"+i;if(u.trim()===""&&i.trim()==="")return;const E=new FormData;E.append("data",R),$(!0);try{const o=await pt("/Home/GrabarDatosVarios",{method:"POST",body:E});if(o){if(z("Datos Guardados Correctamente ..."),ct("success"),st(!0),o.trim()!==""){const D=o.trim().split("^"),F=S.current.find(_=>_?.dataset?.item==="10");if(F.dataset.value=D?.[0],D.length>1){const y=D.slice(1).flatMap(T=>T.split("~")).slice(2),M=y.map(lt);w(T=>({...T,listaDatos:y,hash:M}))}}S.current.forEach(D=>{D&&(D.dataset.valor=D.dataset.value??"")})}}catch(o){console.error(o),z("Error al guardar la informacion ..."),ct("error")}finally{$(!1),setTimeout(()=>{z("")},2e3)}},[et,it,pt]);n.useEffect(()=>{Nt&&a()},[Nt,a]);const d=typeof rt?.[0]=="string"?rt?.[0]?.split("~"):[],x=d?.[0]?.split("|")??[],g=d?.[1]?.split("|")??[],v=d?.[2]?.split("|")??[],O=(g??[]).map((t,s)=>({data:(x??[])[s]??"",metadata:(t??"").split("*")})).map(t=>{const s=[...t.metadata??[]],i=s[9];if(i&&i.includes("+")){const[u,e]=i.split("+");return s[9]=u,{...t,metadata:s,_orden:Number(e)||0}}return{...t,metadata:s,_orden:0}}).sort((t,s)=>t._orden-s._orden).map(({_orden:t,...s})=>s),A=(rt??[]).slice(1),j=n.useMemo(()=>(A??[]).reduce((t,s)=>{const[i,...u]=s.split("~");return t[i]=u,t},{}),[A]);n.useEffect(()=>{const t=j[743];t&&t.length>0&&tt(t)},[]),n.useEffect(()=>{const t=j?.[741]?.[0];t&&W(t)},[j]);const V=v.map(t=>{const[s,i]=t.split("*");return{id:s,nombre:i}}).filter(t=>t.id!==void 0).map(t=>({...t,items:O.filter(s=>s.metadata[9]===t.id)}));n.useEffect(()=>{S.current=S.current.filter(t=>t!==null)},[V]),n.useEffect(()=>{S.current.forEach(t=>{t?.tagName==="SELECT"&&t.options.length>0&&!t.dataset.value&&(t.dataset.value=t.options[0].value??"")})},[V]);const gt=t=>{const{value:s,valor:i,campo:u,item:e}=t.target.dataset;Q(r=>({...r,[e]:{value:s,valor:i,item:e}}))};if(Ht)return f.jsx("div",{children:"Cargando datos..."});if(Ct)return f.jsxs("div",{children:["Error: id_vehiculo",Ct.message]});if(!rt)return f.jsx("div",{children:"No hay datos disponibles"});const Mt=(t,s,i)=>j?.[t]??[],Ut=()=>{},_t=t=>{const{selectedItems:s}=k.getState();if(!s||s.length===0)return;const i=s[0],u=j[t]?.slice(1)?.[0]?.split("*")??[];setTimeout(()=>{const e=u.map(h=>{const[b,m]=h.split("|");return{item:b,indice:Number(m)}});Q(h=>{const b={...h};return e.forEach(({item:m,indice:R})=>{const E=S.current[m];if(!E)return;const o=i[R]??"";E.value=o,E.dataset.value=o,b[m]={value:o,item:E.dataset.item??""}}),b});const{setSelectedItems:r}=k.getState();r([])},500)},$t=t=>{dt(t);const s=[{item:"4",index:3},{item:"30",index:8},{item:"31",index:9},{item:"32",index:10},{item:"34",index:5},{item:"35",index:6}],i="993",u=S.current.find(e=>e?.dataset?.item===i);t?(u&&u.tagName==="SELECT"&&(u.dataset.value=t[4],Z(e=>({...e,[i]:{value:t[4],label:t[11]}})),G(e=>({...e,[i]:1}))),s.forEach(({item:e,index:r})=>{S.current.forEach(h=>{h?.dataset?.item===e&&(h.dataset.value=t[r],h.value=t[r])})}),J(e=>({...e,[i]:!0}))):(u&&u.tagName==="SELECT"&&(setTimeout(()=>{u.dataset.value=""},1e3),Z(e=>({...e,[i]:{value:"",label:""}})),G(e=>({...e,[i]:0}))),s.forEach(({item:e})=>{S.current.forEach(r=>{r?.dataset?.item===e&&(r.dataset.value="",r.value="")})}),J(e=>({...e,[i]:!1})))},zt=()=>{const t=["4","30","31","32","34","35"],s=S.current.filter(Boolean);t.forEach(e=>{const r=s.find(h=>h?.dataset?.item===e);r&&(r.dataset.value="",r.value="")});const i="993",u=s.find(e=>e?.dataset?.item===i);u&&u.tagName==="SELECT"&&(setTimeout(()=>{u.dataset.value=""},1e3),Z(e=>({...e,[i]:{value:"",label:""}})),G(e=>({...e,[i]:0})))},Kt=()=>{if(B?.["993"]){const t=[];[{item:"993",index:[4,11]},{item:"4",index:[3,12]},{item:"30",index:8},{item:"31",index:9},{item:"32",index:10},{item:"34",index:[5,13]},{item:"35",index:6}].forEach(({item:u,index:e})=>{S.current.forEach(r=>{if(r?.dataset?.item===u)if(r&&r.tagName==="SELECT"){const[h,b]=e;t[h]=r.dataset.value,K[h]=t[h];let m=r.options[r.selectedIndex];!m&&r.options.length>0&&(m=r.options[0]),m?(t[b]=m.textContent.trim(),K[b]=t[b]):(t[b]="",K[b]=t[b])}else(Array.isArray(e)?e:[e]).forEach(b=>{t[b]=r.dataset.value,K[b]=t[b]})})});const i=Number(K.slice(-1)[0])+2;if(!isNaN(i)){const u=K.slice(0,-1).join("|"),e=lt(u),r=C?.hash[i];if(e!==r){const h=[...C.listaDatos||[]];h[i]=u,w({...C,listaDatos:h})}}}else{const t=[];[{item:"993",index:[4,11]},{item:"4",index:[3,12]},{item:"30",index:8},{item:"31",index:9},{item:"32",index:10},{item:"34",index:[5,13]},{item:"35",index:6}].forEach(({item:r,index:h})=>{S.current.forEach(b=>{if(b?.dataset?.item===r)if(b&&b.tagName==="SELECT"){const[m,R]=h;t[m]=b.dataset.value;let E=b.options[b.selectedIndex];!E&&b.options.length>0&&(E=b.options[0]),E?t[R]=E.textContent.trim():t[R]=""}else(Array.isArray(h)?h:[h]).forEach(R=>{t[R]=b.dataset.value})})});let i=!0;const u=S.current.find(r=>r.dataset.item==="4"&&r.dataset.value!==""),e=S.current.find(r=>r.dataset.item==="993"&&r.dataset.value!=="");if(i=!!u&&!!e,!i)alert("EXISTEN DATOS REQUERIDOS :");else{if(S.current.forEach(r=>{r?.type==="hidden"&&r?.dataset?.item==="10"&&(t[2]=r.dataset.value)}),t[0]=Ot,t[1]="",t[7]="1",!C?.listaDatos||C.listaDatos.length===0){const h=[...j[741].slice(1),t.join("|")];w({title:"PROGRAMACION DE RUTAS:",isPaginar:!1,listaDatos:h,offsetColumnas:11,hash:""})}else{const r=[...C.listaDatos||[],t.join("|")];w({...C,listaDatos:r})}zt()}}},Xt=t=>{if(!t)return;const s=[...C.listaDatos||[]],i=t.index;if(t.fila[1]==="")i>-1&&i<s.length&&(s.splice(i,1),w({...C,listaDatos:s}));else if(i>-1&&i<s.length){const u=s[i].split("|");u[7]=t.checked===1?"0":"1",s[i]=u.join("|"),w({...C,listaDatos:s})}},Qt=t=>{if(Array.isArray(t)&&t[1]!==""){const s=j[77];X({etiqueta:t[11],ancho:"1200",optionsProp:s,offsetColumnas:1,progRuta:t[1],metaDataKeys:Ft,usuario:it}),ut(!0)}else alert("El nuevo registro debe ser grabado previamente..")},Yt=()=>{console.log("DESDE EL POPUP GRIFOS...")},Zt=t=>{if(t){const[s,...i]=t.split("~");j[743]=[...i];const u=[...i];tt(u)}},Jt=()=>{nt(!0)},Wt=()=>{Lt(-1)},te={990:"/Home/TraerDatosProgVehiculoAyudas",991:"/Home/TraerDatosProgUnidadesAyudas",992:"/Home/TraerDatosProgCIPAyudas",993:"/Home/TraerDatosProgUnidadesAyudas"};return f.jsxs(f.Fragment,{children:[f.jsx("div",{className:"text-xl font-bold mb-4 text-green-800 flex items-center justify-between gap-2",children:f.jsx("span",{className:"text-green-800",children:bt?"EDITAR":"NUEVO"})}),V.map(t=>t.items.length>0&&f.jsxs("div",{className:"mb-8",children:[f.jsx("h2",{className:"text-lg font-semibold text-green-700 mb-4 border-b border-green-300 pb-1",children:t.nombre}),f.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:t.items.map(s=>{const i=O.findIndex(o=>o.metadata[0]===s.metadata[0]),{data:u,metadata:e}=s,r=Number(e?.[5]??0);let h=e?.[3]?Number(e[3]):0;const b=e?.[1]==="0",m=e?.[8]==="1",R=e?.[14]==="1";h=e?.[4]===""?h:Number(e[4]);const E={"-1":"w-1/2",1:"col-span-1",2:"col-span-2",3:"col-span-3",4:"col-span-4"};return f.jsx("div",{className:`${E[e?.[10]]??"col-span-1"} min-w-0`,children:f.jsx(xt,{ref:o=>{o&&(S.current[e[6]]=o)},typeCode:r,etiqueta:e[7]??"",placeholder:e[7]??"",popupTipo:e[6]??"",url:te[e[6]]??"",onPopupClick:()=>Ut(e[6]),onPopupClose:()=>_t(e[6]),style:R?{visibility:"hidden",position:"absolute",width:0,height:0,overflow:"hidden"}:{},...h>0?{maxLength:h}:{},...m?{disabled:!0}:{},...b?{required:!0}:{},...r===103?{checked:(q[e[0]]?.value??u)==="1"}:{},...e?.[2]==="1"&&r===101?{tipoDato:"entero"}:{},...e?.[2]==="2"&&r===101?{tipoDato:"decimal"}:{},...r===111?{defaultValue:j[e[6]]?.length>0?s.metadata[0]:"",...e?.[11]==="1"?{isDefault:1}:{}}:r===151?{defaultValue:s.data,unaLinea:e?.[11],offsetColumnas:e?.[12],ancho:e?.[13],isFilter:e[0]==="1.11"?Dt:"",forcedOption:Y?.[e[6]]??null,optionFlag:U?.[e[6]]??null,setOptionFlag:o=>{G(D=>({...D,[e[6]]:o}))},usarHardcodedExterno:B[e[6]]??!1}:{defaultValue:s.data},dataAttrs:{value:q[e[6]]?.value??u,valor:u,campo:e[0],item:e[6]},onChange:gt,...j[e[6]]||q[e[0]]?.listaAux?{options:(()=>{const o=Mt(e[6],e[0])||[],D=q[e[0]]?.listaAux,F=Array.isArray(D)?D.filter(_=>_&&_.trim()!==""):[];return o.concat(F)})()}:{}})},`${i}-${It}`)})})]},t.id)),f.jsxs("div",{className:"mt-8 mb-2",children:[f.jsx(xt,{typeCode:120,onClick:()=>Kt(),style:{width:"50%"},className:"font-bold text-white text-lg border border-gray-300 rounded shadow-md px-3 py-1",children:B?.["993"]?"MODIFICANDO LA RUTA":"AGREGAR RUTA NUEVA"}),(!C?.listaDatos||C?.listaDatos.length===0)&&f.jsx("h2",{className:"mt-4 text-lg font-semibold text-green-700 mb-4 border-b border-green-300 pb-1",children:"PROGRAMACION DE RUTAS"}),C?.listaDatos&&C?.listaDatos.length>0&&f.jsx(Vt,{configTable:C,handleRadioClick:$t,handleCheckDelete:Xt,isEditing:!0,onSelect:Qt}),P&&f.jsx(re,{ref:Rt,parentRef:Rt,onClose:t=>{Zt(t),ut(!1),X({})},etiqueta:H.etiqueta,ancho:H.ancho,listaDatos:H.optionsProp,onChange:Yt,offsetColumnas:H.offsetColumnas,progRuta:H.progRuta,metaDataKeys:H.metaDataKeys,usuario:H.usuario})]}),f.jsxs("div",{className:"mt-8 mb-2",children:[At&&f.jsx("div",{className:"mt-3 p-3 text-sm text-white bg-red-400 rounded-md shadow-md animate-bounce",children:At}),Tt&&f.jsx("div",{className:`mt-3 p-3 text-sm rounded-md shadow-md ${Et==="success"?"bg-green-700 text-white animate-bounce":"bg-red-400 text-white animate-bounce"}`,children:Tt}),f.jsxs("div",{className:"flex justify-between items-center w-full gap-4 mt-8 mb-2",children:[f.jsx(xt,{typeCode:120,onClick:Jt,className:"!w-auto",...jt?{disabled:!0}:{},children:jt?"Guardando...":"GUARDAR"}),f.jsx("button",{onClick:Wt,className:"px-4 py-2 rounded-md shadow-sm bg-gray-300 text-black cursor-pointer opacity-50",children:"CERRAR"})]})]}),Gt&&f.jsx(ie,{message:"Â¿Deseas guardar los cambios?",onConfirm:()=>{nt(!1),ht()},onCancel:()=>nt(!1)})]})};export{he as default};
