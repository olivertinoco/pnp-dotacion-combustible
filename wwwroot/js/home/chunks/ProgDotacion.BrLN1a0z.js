import{r as f,j as e,d as F,u as K}from"../index.DKk2s01l.js";import{u as J,L as B,S as Q,P as Z}from"./Stack.eFpAXuqd.js";import{u as k,w as ee}from"./xlsx.D6SFf1Cq.js";const U=f.createContext(),te=({children:a})=>{const[s,h]=f.useState({listaDotacion:[],listaVehiculo:[],listaOperatividad:[],hlpTipoFuncion:[],hlpTipoRegistro:[],hlpTipoVehiculo:[]});return f.useEffect(()=>{(async()=>{try{const r=await(await fetch("/Home/TraerListaDotacionCombustible")).text();if(r==="error"){console.error("Error en el servidor al obtener datos");return}const[u,d,o,t,l,n]=r.trim().split("^");h({listaDotacion:u?.split("~")??[],listaVehiculo:d?.split("~")??[],listaOperatividad:o?.split("~")??[],hlpTipoFuncion:t?.split("~")??[],hlpTipoRegistro:l?.split("~")??[],hlpTipoVehiculo:n?.split("~")??[]})}catch(m){console.error("Error al obtener datos:",m)}})()},[]),e.jsx(U.Provider,{value:s,children:a})},_=()=>f.useContext(U),oe=({show:a,onClose:s,title:h,message:c})=>a?e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-white/10 backdrop-blur-sm z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6 max-w-sm w-full text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:h}),e.jsx("p",{className:"text-sm text-gray-600",children:c}),e.jsx("button",{onClick:s,className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Aceptar"})]})}):null;function se(a,s,h,c){return f.useMemo(()=>{if(!a||a.length===0)return[];const{tipoRegistro:m,tipoFuncion:x,tipoVehiculo:r,placaInterna:u}=s||{},d=[m,x,r,u].some(t=>!!(t&&String(t).trim()!=="")),o=t=>!(m&&t[0]!==m.trim()||x&&t[1]!==x.trim()||r&&t[2]!==r.trim()||u&&!(t[5]??"").toString().toUpperCase().startsWith(u.toUpperCase()));if(h==="vehiculo"){if(!d)return a;const t=a.filter((l,n)=>{if(n<2)return!0;const i=l.split("|");return o(i)});return t.length>2?t:a.slice(0,2)}if(h==="dotacion"){if(!d)return a;const t=(c||[]).filter((i,p)=>{if(p<2)return!1;const g=i.split("|");return o(g)}),l=new Set(t.map(i=>(i.split("|")[4]??"").trim().toUpperCase())),n=a.filter((i,p)=>{if(p<2)return!0;const g=(i.split("|")[2]??"").trim().toUpperCase();return l.has(g)});return n.length>2?n:a.slice(0,2)}return a},[a,s,h,c])}const ne=(a,s,h,c)=>{const[m,x]=f.useState(!1),r=f.useRef(null),u=f.useRef(null),d=a.length>2?a.length-2:0;f.useEffect(()=>{x(d===0)},[d,c]);const o=f.useMemo(()=>s&&s.length>1?s[0].split("|"):[],[s]),t=f.useMemo(()=>s&&s.length>1?s[1].split("|").map((g,b)=>[o[b],Number(g)]):[],[s,o]),l=f.useMemo(()=>h==="dotacion"||h==="operativo"?t:t.slice(3),[t,h]),n=f.useMemo(()=>l.reduce((g,b)=>g+b[1],0),[l]),i=J({count:a.length,getScrollElement:()=>u.current,estimateSize:()=>35});return{showPopup:m,setShowPopup:x,totalRegistros:d,titulo:o,cabeceraFiltrada:l,totalWidth:n,rowVirtualizer:i,scrollBarRef:r,tableContainerRef:u,syncScroll:g=>{!u.current||!r.current||window.requestAnimationFrame(()=>{g==="table"?r.current.scrollLeft=u.current.scrollLeft:u.current.scrollLeft=r.current.scrollLeft})}}};var C={exports:{}},ae=C.exports,A;function re(){return A||(A=1,(function(a,s){(function(h,c){c()})(ae,function(){function h(o,t){return typeof t>"u"?t={autoBom:!1}:typeof t!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(o.type)?new Blob(["\uFEFF",o],{type:o.type}):o}function c(o,t,l){var n=new XMLHttpRequest;n.open("GET",o),n.responseType="blob",n.onload=function(){d(n.response,t,l)},n.onerror=function(){console.error("could not download file")},n.send()}function m(o){var t=new XMLHttpRequest;t.open("HEAD",o,!1);try{t.send()}catch{}return 200<=t.status&&299>=t.status}function x(o){try{o.dispatchEvent(new MouseEvent("click"))}catch{var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),o.dispatchEvent(t)}}var r=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof F=="object"&&F.global===F?F:void 0,u=r.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),d=r.saveAs||(typeof window!="object"||window!==r?function(){}:"download"in HTMLAnchorElement.prototype&&!u?function(o,t,l){var n=r.URL||r.webkitURL,i=document.createElement("a");t=t||o.name||"download",i.download=t,i.rel="noopener",typeof o=="string"?(i.href=o,i.origin===location.origin?x(i):m(i.href)?c(o,t,l):x(i,i.target="_blank")):(i.href=n.createObjectURL(o),setTimeout(function(){n.revokeObjectURL(i.href)},4e4),setTimeout(function(){x(i)},0))}:"msSaveOrOpenBlob"in navigator?function(o,t,l){if(t=t||o.name||"download",typeof o!="string")navigator.msSaveOrOpenBlob(h(o,l),t);else if(m(o))c(o,t,l);else{var n=document.createElement("a");n.href=o,n.target="_blank",setTimeout(function(){x(n)})}}:function(o,t,l,n){if(n=n||open("","_blank"),n&&(n.document.title=n.document.body.innerText="downloading..."),typeof o=="string")return c(o,t,l);var i=o.type==="application/octet-stream",p=/constructor/i.test(r.HTMLElement)||r.safari,g=/CriOS\/[\d]+/.test(navigator.userAgent);if((g||i&&p||u)&&typeof FileReader<"u"){var b=new FileReader;b.onloadend=function(){var j=b.result;j=g?j:j.replace(/^data:[^;]*;/,"data:attachment/file;"),n?n.location.href=j:location=j,n=null},b.readAsDataURL(o)}else{var w=r.URL||r.webkitURL,S=w.createObjectURL(o);n?n.location=S:location.href=S,n=null,setTimeout(function(){w.revokeObjectURL(S)},4e4)}});r.saveAs=d.saveAs=d,a.exports=d})})(C)),C.exports}var ie=re();const le=()=>({exportToExcel:(s,h,c="vehiculo")=>{if(!s||s.length===0)return;const m=s[0]?.split("|")??[],x=c==="vehiculo"?m.slice(3):m,r=s.slice(2).map(n=>{const i=n.split("|");return c==="vehiculo"?i.slice(3):i}),u=[x,...r].filter(n=>Array.isArray(n)&&n.length>0);if(u.length===0)return;const d=k.aoa_to_sheet(u),o=k.book_new();k.book_append_sheet(o,d,"Datos");const t=ee(o,{bookType:"xlsx",type:"array"}),l=new Blob([t],{type:"application/octet-stream"});ie.saveAs(l,h)}}),ce=()=>{const a=new Date,s=o=>String(o).padStart(2,"0"),h=a.getFullYear(),c=s(a.getMonth()+1),m=s(a.getDate()),x=s(a.getHours()),r=s(a.getMinutes()),u=s(a.getSeconds()),d=String(a.getMilliseconds()).padStart(3,"0");return`${h}${c}${m}.${x}.${r}.${u}.${d}`},D=({configTable:a})=>{const{tipo:s,title:h,buscar:c,exportExcel:m,setExportExcel:x,isPaginar:r}=a,{listaDotacion:u,listaVehiculo:d,listaOperatividad:o}=_(),t=f.useMemo(()=>{switch(s){case"dotacion":return u;case"vehiculo":return d;case"operativo":return o;default:return[]}},[s,u,d,o]),l=se(t,c,s,s==="operativo"?o:d),n=l&&l.length>2?l.slice(2):[],[i,p]=f.useState(1),g=20;f.useEffect(()=>{p(1)},[c]);const b=Math.max(1,Math.ceil(n.length/g));f.useEffect(()=>{r&&i>b&&p(b)},[r,i,b]);const w=(i-1)*g,S=w+g,j=n.slice(w,S),q=(v,y)=>{y>=1&&y<=b&&p(y)},V=r?j:l,{showPopup:z,setShowPopup:W,totalRegistros:H,cabeceraFiltrada:N,totalWidth:T,rowVirtualizer:$,scrollBarRef:I,tableContainerRef:O,syncScroll:L}=ne(V,t,s,c),{exportToExcel:M}=le();return f.useEffect(()=>{if(m){const v=s==="vehiculo"?"prog-vehiculos":"prog-dotacion",y=ce(),E=`${v}.${y}.xlsx`;M(t,E,s),x(!1)}},[m,t,s,M,x]),!l||l.length<=1?e.jsx(B,{}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{ref:O,className:"relative overflow-auto max-h-[90vh] bg-white shadow-lg rounded-lg border border-gray-200",onScroll:()=>L("table"),children:[e.jsx("div",{className:"sticky top-0 left-0 z-30 bg-white shadow-md",children:e.jsxs("h2",{className:"text-left text-xl font-bold text-gray-800 py-2 px-4",children:[h," ",e.jsx("span",{className:"ml-2 text-sm font-medium text-gray-500",children:r?`(${l.length-2} vehiculos)`:`(${H} vehiculos)`})]})}),e.jsx("div",{className:"sticky top-10 z-20 flex border-b border-gray-300 bg-gray-100",style:{width:`${T}px`},children:N.map((v,y)=>e.jsx("div",{className:"px-2 py-2 font-semibold text-left",style:{width:`${v[1]}px`,minWidth:`${v[1]}px`,maxWidth:`${v[1]}px`,flexShrink:0},children:v[0]},y))}),e.jsx("div",{className:"relative",style:{height:r?`${$.getVirtualItems().length*35}px`:`${$.getTotalSize()}px`,width:`${T}px`},children:$.getVirtualItems().map(v=>{const y=r?0:2,E=V[v.index+y];if(!E)return null;const P=E.split("|"),G=s==="dotacion"||s==="operativo"?P:P.slice(3),X=v.index%2===0;return e.jsx("div",{className:`absolute left-0 flex border-b border-gray-200 cursor-pointe ${X?"bg-white":"bg-gray-50"} hover:bg-gray-100 active:bg-gray-200 transition-colors duration-150`,style:{transform:`translateY(${v.start}px)`,width:`${T}px`},children:G.map((Y,R)=>e.jsx("div",{className:"px-2 py-2 text-left truncate",style:{width:`${N[R][1]}px`,minWidth:`${N[R][1]}px`,maxWidth:`${N[R][1]}px`,flexShrink:0},children:Y},R))},v.index)})})]}),e.jsx("div",{ref:I,className:"fixed bottom-0 left-0 w-full h-5 overflow-x-auto bg-gray-100",onScroll:()=>L("bar"),children:e.jsx("div",{className:"h-1",style:{width:`${T}px`}})}),r&&e.jsx(Q,{spacing:2,className:"mt-4 flex justify-center",children:e.jsx(Z,{count:b,page:i,onChange:q,shape:"rounded",color:"primary"})}),e.jsx(oe,{show:z,onClose:()=>W(!1),title:"Sin datos encontrados",message:"No existen registros que coincidan con tu búsqueda."})]})},ue=({visible:a=!1,onBuscar:s})=>{const{hlpTipoFuncion:h,hlpTipoRegistro:c,hlpTipoVehiculo:m}=_(),[x,r]=f.useState(""),[u,d]=f.useState(""),[o,t]=f.useState(""),[l,n]=f.useState("");f.useEffect(()=>{a&&(r(""),d(""),t(""),n(""))},[a]);const i=()=>{s&&s({tipoRegistro:x,tipoFuncion:u,tipoVehiculo:o,placaInterna:l})};return e.jsxs("div",{className:`border border-gray-300 rounded-lg p-4 ${a?"block":"hidden"}`,children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Filtros de Búsqueda"}),e.jsxs("div",{className:"grid grid-cols-5 gap-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm font-semibold text-gray-700 mb-1",children:"Tipo de Registro"}),e.jsxs("select",{className:"border border-gray-300 w-full px-3 rounded-md focus:outline-none focus:ring-1 focus:ring-purple-600 h-11",value:x,onChange:p=>r(p.target.value),children:[e.jsx("option",{value:"",children:"TODOS"}),c.map(p=>{const[g,b]=p.split("|");return e.jsx("option",{value:g,children:b},g)})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm font-semibold text-gray-700 mb-1",children:"Tipo de Función"}),e.jsxs("select",{className:"border border-gray-300 w-full px-3 rounded-md focus:outline-none focus:ring-1 focus:ring-purple-600 h-11",value:u,onChange:p=>d(p.target.value),children:[e.jsx("option",{value:"",children:"TODOS"}),h.map(p=>{const[g,b]=p.split("|");return e.jsx("option",{value:g,children:b},g)})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm font-semibold text-gray-700 mb-1",children:"Tipo de Vehículo"}),e.jsxs("select",{className:"border border-gray-300 w-full px-3 rounded-md focus:outline-none focus:ring-1 focus:ring-purple-600 h-11",value:o,onChange:p=>t(p.target.value),children:[e.jsx("option",{value:"",children:"TODOS"}),m.map(p=>{const[g,b]=p.split("|");return e.jsx("option",{value:g,children:b},g)})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm font-semibold text-gray-700 mb-1",children:"Placa Interna"}),e.jsx("input",{className:"border border-gray-300 w-full px-3 rounded-md focus:outline-none focus:ring-1 focus:ring-purple-600 invalid:focus:ring-red-400 solo-enteros h-11",type:"text",maxLength:"10",placeholder:"Busqueda por placa interna...",autoComplete:"off",value:l,onChange:p=>n(p.target.value.toUpperCase())})]}),e.jsx("div",{className:"flex flex-col justify-end",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"bg-blue-600 text-white font-semibold px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition h-11",onClick:i,children:"Buscar"}),e.jsx("button",{className:"bg-gray-300 text-gray-700 font-semibold px-4 rounded-md hover:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-gray-400 transition h-11",onClick:()=>{r(""),d(""),t(""),n(""),s&&s({tipoRegistro:"",tipoFuncion:"",tipoVehiculo:"",placaInterna:""})},children:"Limpiar"})]})})]})]})},de=({bannerConfig:a})=>{const{activeTab:s,mostrarFiltros:h,switchTab:c,setMostrarFiltros:m,setFiltrosAplicados:x,setExportExcel:r}=a;return e.jsxs("div",{className:"flex justify-between mb-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:`px-4 py-2 rounded ${s==="operativo"?"bg-blue-500 text-white":"bg-gray-200"}`,onClick:()=>{c("operativo"),m(!1),x(null)},children:"Programacion Operatividad"}),e.jsx("button",{className:`px-4 py-2 rounded ${s==="vehiculo"?"bg-blue-500 text-white":"bg-gray-200"}`,onClick:()=>c("vehiculo"),children:"Programacion Vehículos"}),e.jsx("button",{className:`px-4 py-2 rounded ${s==="dotacion"?"bg-blue-500 text-white":"bg-gray-200"}`,onClick:()=>c("dotacion"),children:"Programacion Dotación"})]}),s!=="operativo"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{className:"px-4 py-2 rounded bg-blue-500 text-white",onClick:()=>{m(u=>{const d=!u;return d&&x(null),d})},children:h?"Ocultar filtros":"Mostrar filtros"}),e.jsx("button",{className:"px-4 py-2 rounded bg-blue-500 text-white",onClick:()=>r(!0),children:s==="dotacion"?"Exp. Excel Dotación":"Exp. Excel Vehículo"})]})]})},pe=()=>{const[a,s]=f.useState("operativo"),[h,c]=f.useState(!1),[m,x]=f.useTransition(),[r,u]=f.useState(null),[d,o]=f.useState(!1),t=p=>{x(()=>{s(p)})},l=p=>{u(p)},n={activeTab:a,mostrarFiltros:h,switchTab:t,setMostrarFiltros:c,setFiltrosAplicados:u,setExportExcel:o},i={tipo:a,title:a==="vehiculo"?"Tabla de Vehículos":a==="dotacion"?"Tabla de Dotación de Combustible":"Tabla de Operatividad Vehicular",buscar:r,exportExcel:d,setExportExcel:o,isPaginar:!0};return e.jsxs("div",{className:"p-5 relative",children:[e.jsx(ue,{visible:a!=="operativo"&&h,onBuscar:l}),m&&e.jsx(B,{}),e.jsx(de,{bannerConfig:n}),a==="operativo"&&e.jsx(D,{configTable:i}),a==="vehiculo"&&e.jsx(D,{configTable:i}),a==="dotacion"&&e.jsx(D,{configTable:i})]})};function me(){return K().state?.value,e.jsxs(te,{children:[e.jsx(pe,{}),";"]})}export{me as default};
