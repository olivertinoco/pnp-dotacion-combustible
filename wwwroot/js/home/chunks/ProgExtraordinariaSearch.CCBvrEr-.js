import{u as G,e as J,r as d,j as s}from"../index.DKk2s01l.js";import{u as Q}from"./useFetch.D2-L_2OD.js";import{u as W}from"./useTablaVirtualizadaCustom.YaVcVRmy.js";import{a as X,u as b,C as Z}from"./CustomElement.A4zDmkLk.js";import{B as ee}from"./BaseTablaMatriz2.CIkwegTK.js";import"./Stack.eFpAXuqd.js";const le=()=>{const R=G(),v=J(),A=R.state?.value,N=d.useRef([]),[u,F]=d.useState({}),[k,C]=d.useState(!1),[_,j]=d.useState({}),q="/Home/Busqueda_prog_ord_extra",{data:p,loading:B,error:y}=Q(q),{runFetch:E}=W(),I=X(N),{handleClick:L,esValido:w,valoresCambiados:f}=I,S=typeof p?.[0]=="string"?p?.[0]?.split("~"):[],T=S?.[0]?.split("|")??[],M=(S?.[1]?.split("|")??[]??[]).map((t,r)=>({data:(T??[])[r]??"",metadata:(t??"").split("*")})),D=(p??[]).slice(1),g=d.useMemo(()=>(D??[]).reduce((t,r)=>{const[o,...e]=r.split("~");return t[o]=e,t},{}),[D]),V=()=>{console.log("handlePopup")},H=()=>{console.log("handlePopupClose")},U=t=>{const{value:r,valor:o,campo:e,item:n}=t.target.dataset;F(l=>({...l,[n]:{value:r,valor:o,item:n}}))},z=t=>g?.[t]??[],P=d.useCallback(async()=>{const t=[...f.data],r=[...f.campos],o={},e=[];["400.1","400.2","400.3","400.4","400.5"].forEach(a=>{o[a]=""}),r.forEach((a,i)=>{Object.hasOwn(o,a)&&(o[a]=t[i])}),Object.keys(o).sort((a,i)=>Number(a)-Number(i)).forEach(a=>{e.push(o[a].trim())});const n=e[3],l=e[4];if(n!==""&&l!==""){const a=new Date(n),i=new Date(l);if(isNaN(a)||isNaN(i)){alert("Formato de fecha inválido");return}if(a>i){alert("La fecha inicial no puede ser mayor que la fecha final.");return}}if(n===""&&l!==""){alert("No puede ingresar fecha final sin fecha inicial");return}if(e.slice(1).join("|")==="|||"){alert("Debe ingresar un dato a buscar");return}const x=e.join("|"),m=new FormData;m.append("data",x);try{const a=await E("/Home/Busqueda_listar_datos_prog_extra",{method:"POST",body:m});if(a&&a.trim()!==""){const i=a.split("~");if(i.length===2){j(c=>({...c,listasData:[]})),C(!1),b.setState({selectedItems:[]}),alert("NO SE ENCONTRO INFORMACION");return}j({title:"Encontrados de Programación Ordinaria - Extraordinaria :",isPaginar:!1,listaDatos:i,offsetColumnas:1,hash:""}),C(!0)}}catch(a){console.error(a)}},[f,E]);d.useEffect(()=>{w&&P()},[w,P]);const K=()=>{b.setState({selectedItems:[]}),v("/prog-extra-ord-base")},Y=t=>{const{setSelectedItems:r}=b.getState();t.push(A),r([t]),v("/prog-extra-ord-base")};return B?s.jsx("div",{children:"Cargando datos..."}):y?s.jsxs("div",{children:["Error: ",y.message]}):p?s.jsxs(s.Fragment,{children:[s.jsx("h1",{className:"p-2 text-2xl font-bold text-green-800",children:"Busqueda de Programación Ordinaria - Extraordinaria"}),s.jsx("div",{className:"max-w-[50vw] w-full",children:s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:M.map((t,r)=>{const{data:o,metadata:e}=t,n=Number(e?.[5]??0);let l=e?.[3]?Number(e[3]):0;const x=e?.[1]==="0",m=e?.[8]==="1",a=e?.[14]==="1";l=e?.[4]===""?l:Number(e[4]);const i={"-1":"w-1/2",1:"col-span-1",2:"col-span-2",3:"col-span-3",4:"col-span-4"};return s.jsx("div",{className:`${i[e?.[10]]??"col-span-1"} min-w-0`,children:s.jsx(Z,{ref:c=>{c&&(N.current[e[6]]=c)},typeCode:n,etiqueta:e[7]??"",placeholder:e[7]??"",popupTipo:e[6]??"",onPopupClick:()=>V(e[6]),onPopupClose:(c,h)=>H(c,h,e[6]),style:a?{visibility:"hidden",position:"absolute",width:0,height:0,overflow:"hidden"}:{},...l>0?{maxLength:l}:{},...m?{disabled:!0}:{},...x?{required:!0}:{},...n===103?{checked:(u[e[0]]?.value??o)==="1"}:{},...e?.[2]==="1"&&n===101?{tipoDato:"entero"}:{},...e?.[2]==="2"&&n===101?{tipoDato:"decimal"}:{},...n===111?{defaultValue:g[e[6]]?.length>0?t.metadata[0]:"",...e?.[11]==="1"?{isDefault:1}:{}}:n===151?{defaultValue:t.data,unaLinea:e?.[11],offsetColumnas:e?.[12],ancho:e?.[13]}:{defaultValue:t.data},dataAttrs:{value:u[e[6]]?.value??o,valor:o,campo:e[0],item:e[6]},onChange:U,...g[e[6]]||u[e[0]]?.listaAux?{options:(()=>{const c=z(e[6])||[],h=u[e[0]]?.listaAux,$=Array.isArray(h)?h.filter(O=>O&&O.trim()!==""):[];return c.concat($)})()}:{}})},r)})})}),s.jsxs("h2",{className:"p-2 mt-4 text-lg font-medium text-green-700 mb-4 border-b border-green-300 pb-1 flex justify-between items-center",children:[s.jsx("span",{children:"Búsqueda de programación ordinaria - extraordinaria"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{type:"button",onClick:L,className:"bg-green-700 text-white px-3 py-1 rounded-md hover:bg-green-900 transition",children:"BUSCAR"}),s.jsx("button",{type:"button",onClick:K,className:"bg-green-700 text-white px-3 py-1 rounded-md hover:bg-green-900 transition",children:"NUEVO"})]})]}),s.jsx("div",{className:"mb-4 flex-1 min-h-0 overflow-y-auto pr-2",children:k&&s.jsx("div",{style:{maxHeight:"50vh",overflowY:"auto",border:"1px solid #e5e7eb",borderRadius:"0.5rem"},children:s.jsx(ee,{configTable:_,handleRadioClick:()=>{},handleCheckDelete:()=>{},isEditing:!1,onSelect:Y})})})]}):s.jsx("div",{children:"No hay datos disponibles"})};export{le as default};
